<!DOCTYPE HTML>

<html>
    <head>
        <script type="text/javascript">
            var userConfig = {
                subTitle: 'Stories In-Progress to Accepted',
                debug: true,
                trace: true,
                daysToShow: 120,
                // asOf: "2012-10-15",  // Optional. Only supply if want a specific time frame. Do not send in new Date().toISOString().
                
                scopeField: "_ProjectHierarchy",  // Supports Iteration, Release, Tags, Project, _ProjectHierarchy, _ItemHierarchy
                scopeValue: 'scope',
                
                statePredicate: {ScheduleState:{$lt:"Accepted", $gte:"In-Progress"}},
                currentStatePredicate: {ScheduleState:{$gte:"Accepted"}},
                type: 'HierarchicalRequirement',
                leafOnly: true,
                showTheseFieldsInToolTip: [ // Will automatically show ObjectID and Work Days In State
                  'Name', 
                  {field: 'PlanEstimate', as: "Plan Estimate"}
                ],  
                radiusField: {field: 'PlanEstimate', f: function(value){
                  if (isNaN(value)) {
                    return 5
                  } else {
                    return Math.pow(value, 0.6) + 5
                  }
                }},
                workDayStartOn: {hour: 9},
                workDayEndBefore: {hour: 17},
                // deriveFieldsOnSnapshotsConfig:
                // holidays: (unless we pull them from some data model in Rally)
                // workDays: (if you want to override the default pulling from WorkspaceConfiguration)
            }
            
/*
            // Feature Aging
            userConfig.subTitle = 'Features In Dev and less than 100% done'
            userConfig.daysToShow = 365
            userConfig.statePredicate = {"State":"In Dev", "PercentDoneByStoryCount":{$lt:1,$gt:0}}
            userConfig.currentStatePredicate = {ScheduleState:{$gt:"In Dev"}}
            userConfig.type = 'PortfolioItem/Feature'
            userConfig.leafOnly = false
            userConfig.showTheseFieldsInToolTip = [
              'Name',
              {field: 'LeafStoryCount', as: 'Leaf Story Count'},
              {field: "PercentDoneByStoryCount", as: 'Percent Done By Story Count', f: function(value) {
                return Math.floor(value * 100 + 0.5).toString() + '%';
              }}
            ]
            userConfig.radiusField = {field: 'LeafStoryCount', f: function(value){
              return Math.pow(value, 0.6) + 5
            }}
*/

            
        </script>
        
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>Time In Process (TIP) Chart</title>
        
        <!-- HighCharts -->
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/highcharts.js"></script>
        <script type="text/javascript" src="http://code.highcharts.com/2.1.6/modules/exporting.js"></script>
        <!-- a theme file
            <script type="text/javascript" src="../js/themes/gray.js"></script>
        -->
        
        <!-- Lumenize -->
	<script type="text/javascript" src="https://storage.googleapis.com/versions.lumenize.com/v0.6.6/Lumenize-min.js"></script>
        
        <!-- rally_analytics -->
        
<script type="text/javascript">
(function(){var t,e,s,i,r,n,o,a,l,h,u=function(t,e){return function(){return t.apply(e,arguments)}},p=[].indexOf||function(t){for(var e=0,s=this.length;s>e;e++)if(e in this&&this[e]===t)return e;return-1},c={}.hasOwnProperty,d=function(t,e){function s(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t};a="undefined"!=typeof exports&&null!==exports?require("../lib/Lumenize"):require("/lumenize"),h=a.utils,r=a.Time,null==(null!=h?h.type:void 0)&&(h={},h.type=function(){var t,e,s,i,r;for(t={},r="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),s=0,i=r.length;i>s;s++)e=r[s],t["[object "+e+"]"]=e.toLowerCase();return function(e){var s;return s=Object.prototype.toString.call(e),t[s]||"object"}}()),l=this,t=function(){function t(t,e){var s,i,r,n,o,a,h,p,c,d;this.upToDate=e,this._gotResponse=u(this._gotResponse,this),this._debug=!1,"undefined"==typeof process||null===process||"undefined"!=typeof window&&null!==window?null!=l.XMLHttpRequest&&(s=l.XMLHttpRequest):s=require("xmlhttprequest").XMLHttpRequest,this.XHRClass=s,this._xhr=null,this._find=null,this._fields=[],this._sort={_ValidFrom:1},this._startIndex=0,this._pageSize=1e7,this._callback=null,this.headers={},this.headers["X-RallyIntegrationLibrary"]="rally_analytics-0.1.0","undefined"!=typeof navigator&&null!==navigator?(o=navigator.appName+" "+navigator.appVersion,n=navigator.platform):"undefined"!=typeof process&&null!==process&&(o="Node.js (or some other non-browser) "+process.version,n=process.platform),this.headers["X-RallyIntegrationPlatform"]=o,this.headers["X-RallyIntegrationOS"]=n,h=t.additionalHeaders;for(r in h)a=h[r],this.headers[r]=a;if(i=function(e,s){if(null!=t[s])return e[s]=t[s];throw Error("Must include config["+s+"] header when instantiating this rally_analytics.AnalyticsQuery object")},i(this.headers,"X-RallyIntegrationName"),i(this.headers,"X-RallyIntegrationVendor"),i(this.headers,"X-RallyIntegrationVersion"),null!=t.workspaceOID)this.workspaceOID=t.workspaceOID;else{if(!("undefined"!=typeof process&&null!==process?null!=(p=process.env)?p.RALLY_WORKSPACE:void 0:void 0))throw Error("Must provide a config.workspaceOID or set environment variable RALLY_WORKSPACE");this.workspaceOID=process.env.RALLY_WORKSPACE}this.username=null!=t.username?t.username:("undefined"!=typeof process&&null!==process?null!=(c=process.env)?c.RALLY_USER:void 0:void 0)?process.env.RALLY_USER:void 0,this.password=null!=t.password?t.password:("undefined"!=typeof process&&null!==process?null!=(d=process.env)?d.RALLY_PASSWORD:void 0:void 0)?process.env.RALLY_PASSWORD:void 0,this.protocol="https",this.server="rally1.rallydev.com",this.service="analytics",this.version="v2.0",this.endpoint="artifact/snapshot/query.js",this.virgin=!0,this._hasMorePages=!0,this._firstPage=!0,this.ETLDate=null,this.lastResponseText="",this.lastResponse={},this.lastPageResults=[],this.allResults=[],this.lastPageMeta={},this.allMeta=[]}return t.prototype.resetFind=function(){return this._find=null},t.prototype.find=function(t){return this._find=t,this},t.prototype.sort=function(){throw Error("Sort must be {_ValidFrom: 1}.")},t.prototype._setSort=function(t){return this._sort=t,this},t.prototype.fields=function(t){var e,s,i,r,n,o,a;if("array"===h.type(t))this._fields=this._fields.concat(t);else{if("object"!==h.type(t))throw Error("Don't know what to do. additionalFields is type "+h.type(t)+" and @_fields it type "+h.type(this._fields)+".");if("array"===h.type(this._fields)){for(i={},a=this._fields,n=0,o=a.length;o>n;n++)e=a[n],i[e]=1;this._fields=i}for(s in t)r=t[s],this._fields[s]=r}return this},t.prototype.hydrate=function(t){return this._hydrate=t,this},t.prototype.start=function(t){return this._startIndex=t,this},t.prototype.startIndex=function(t){return this._startIndex=t,this},t.prototype.pagesize=function(t){return this._pageSize=t,this},t.prototype.pageSize=function(t){return this._pageSize=t,this},t.prototype.auth=function(t,e){return this.username=t,this.password=e,this},t.prototype.debug=function(){return this._debug=!0,this},t.prototype.getBaseURL=function(){return this.protocol+"://"+[this.server,this.service,this.version,"service/rally/workspace",this.workspaceOID,this.endpoint].join("/")},t.prototype.getQueryString=function(){var t,e;if(t=JSON.stringify(this._find),null!=this._find&&t.length>2){if(e=[],e.push("find="+t),null!=this._sort&&e.push("sort="+JSON.stringify(this._sort)),null!=this._fields)if(this._fields[0]===!0)e.push("fields=true");else if(this._fields.length>0||"object"===h.type(this._fields)){if(!(p.call(this._fields,"_ValidFrom")>=0||this._fields.hasOwnProperty("_ValidFrom")))if("object"===h.type(this._fields))this._fields._ValidFrom=1;else{if("array"!==h.type(this._fields))throw Error("@_fields is unexpected type "+h.type(this._fields));this._fields.push("_ValidFrom")}e.push("fields="+JSON.stringify(this._fields))}return null!=this._hydrate&&e.push("hydrate="+JSON.stringify(this._hydrate)),e.push("start="+this._startIndex),e.push("pagesize="+this._pageSize),e.join("&")}throw Error("find clause not set")},t.prototype.getURL=function(){var t;return t=this.getBaseURL()+"?"+this.getQueryString(),this._debug&&(console.log("\nfind: ",this._find),console.log("\nurl:"),console.log(t)),encodeURI(t)},t.prototype.getAll=function(t){return this.virgin&&(this.allCallback=t,this.virgin=!1,this.upToDate="2011-12-01T00:00:00.000Z"),this.hasMorePages()?this.getPage(this.getAll):this.allCallback(this)},t.prototype.hasMorePages=function(){return this._hasMorePages},t.prototype.getPage=function(t){var e,s,i;if(this._callback=t,null==this._find)throw Error("Must set find clause before calling getPage");if(null==this.XHRClass)throw Error("Must set XHRClass");if(!this._hasMorePages)throw Error("All pages retrieved. Inspect AnalyticsQuery.allResults and AnalyticsQuery.allMeta for results.");if(null==this.upToDate)throw Error("Must set property upToDate before calling getPage");this._xhr=new this.XHRClass,this._xhr.onreadystatechange=this._gotResponse,this._xhr.open("GET",this.getURL(),!0,this.username,this.password),i=this.headers;for(e in i)s=i[e],this._xhr.setRequestHeader(e,s);return this._xhr.send(),this},t.prototype._gotResponse=function(){var t,e,s,i,r,n,o,a,l;if(this._debug&&console.log("\nreadyState: ",this._xhr.readyState),4===this._xhr.readyState){if(this.lastResponseText=this._xhr.responseText,this._debug&&console.log("Last response text length: ",this.lastResponseText.length),this.lastResponse=JSON.parse(this.lastResponseText),this._debug&&(console.log("\nresponse headers:\n"),console.log(this._xhr.getAllResponseHeaders()),console.log("\nstatus: ",this._xhr.status),"string"==typeof this.lastResponse?console.log("\nlastResponseText: ",this.lastResponseText):console.log("\nlastResponseJSON: ",this.lastResponse)),this.lastResponse.Errors.length>0)return console.log("Errors\n"+JSON.stringify(this.lastResponse.Errors)),this._callback(this.lastPageResults,r,this.upToDate,this);if(this._firstPage)this._firstPage=!1,this.allResults=[],this.allMeta=[],this.ETLDate=this.lastResponse.ETLDate,this._pageSize=this.lastResponse.PageSize,e={$and:[this._find,{_ValidFrom:{$lte:this.ETLDate}}]},this._find=e;else if(this.lastResponse.PageSize!==this._pageSize)throw Error("Pagesize changed after first page which is unexpected.");for(r=this.upToDate,this.lastResponse.Results.length+this.lastResponse.StartIndex>=this.lastResponse.TotalResultCount?(this._hasMorePages=!1,this.upToDate=this.ETLDate):(this._hasMorePages=!0,this.upToDate=this.lastResponse.Results[this.lastResponse.Results.length-1]._ValidFrom),this.lastPageResults=[],i=this.lastResponse.Results,this._debug&&console.log("Length of results before @upToDate filtering: ",i.length),o=0,a=i.length;a>o;o++)s=i[o],s._ValidFrom!==this.upToDate&&this.lastPageResults.push(s);this._debug&&console.log("Length of results after @upToDate filtering: ",this.lastPageResults.length),this._startIndex+=this.lastPageResults.length,this.allResults=this.allResults.concat(this.lastPageResults),this.lastPageMeta={},l=this.lastResponse;for(t in l)n=l[t],"Results"!==t&&(this.lastPageMeta[t]=n);return this.allMeta.push(this.lastPageMeta),this._callback(this.lastPageResults,r,this.upToDate,this)}},t}(),i=function(t){function e(t,s){e.__super__.constructor.call(this,t,s),this._scope={},this._type=null,this._additionalCriteria=[],null!=s&&this._additionalCriteria.push({_ValidTo:{$gt:s}})}return d(e,t),e.prototype.generateFind=function(){var t,e,s,i,r,n;if(e=[],!(JSON.stringify(this._scope).length>2))throw Error("Must set scope first.");for(e.push(this._scope),null!=this._type&&e.push(this._type),r=this._additionalCriteria,s=0,i=r.length;i>s;s++)t=r[s],e.push(t);return(n=e.length)>0&&2>n?e[0]:{$and:e}},e.prototype.find=function(){if(arguments.length>0)throw Error("Do not call find() directly to set query. Use scope(), type(), and additionalCriteria()");return e.__super__.find.call(this,this.generateFind()),this},e.prototype.resetScope=function(){return this._scope={}},e.prototype.scope=function(t,e){var s,i,r,n=this;if(s=function(t,e){var s;if("ItemHierarchy"===t&&(t="_ItemHierarchy"),"Tag"===t&&(t="Tags"),"ProjectHierarchy"===t&&(t="_ProjectHierarchy"),s=["Project","_ProjectHierarchy","Iteration","Release","Tags","Tag","_ItemHierarchy"],0>p.call(s,t))throw Error("Key for scope() call must be one of "+s);return n._scope[t]="array"===h.type(e)?{$in:e}:e},"object"===h.type(t))for(i in t)r=t[i],s(i,r);else{if(2!==arguments.length)throw Error("Must provide an Object in first parameter or two parameters (key, value).");s(t,e)}return this},e.prototype.resetType=function(){return this._type=null},e.prototype.type=function(t){return this._type="array"===h.type(t)?{_TypeHierarchy:{$in:t}}:{_TypeHierarchy:t},this},e.prototype.resetAdditionalCriteria=function(){return this._additionalCriteria=[]},e.prototype.additionalCriteria=function(t){return this._additionalCriteria.push(t),this},e.prototype.leafOnly=function(){return this.additionalCriteria({$or:[{_TypeHierarchy:-51038,Children:null},{_TypeHierarchy:-51078,Children:null,UserStories:null},{_TypeHierarchy:{$nin:[-51038,-51078]}}]}),this},e.prototype.getPage=function(t){return this.find(),e.__super__.getPage.call(this,t)},e}(t),e=function(t){function e(t,s,i){var r,n;if(e.__super__.constructor.call(this,t,s),null==i)throw Error("Must provide a zuluDateString when instantiating an AtAnalyticsQuery.");n={},r=String.fromCharCode(95)+"_At",n[r]=i,this._additionalCriteria.push(n)}return d(e,t),e}(i),s=function(t){function e(t,s,i){var r;if(e.__super__.constructor.call(this,t,s),null==s||null==i)throw Error("Must provide two zulu data strings when instantiating a BetweenAnalyticsQuery.");r={_ValidFrom:{$lt:i},_ValidTo:{$gt:s}},this._additionalCriteria.push(r)}return d(e,t),e}(i),n=function(t){function e(t,s,i){if(e.__super__.constructor.call(this,t,s),null==i)throw Error("Must provide a predicate when instantiating a TimeInStateAnalyticsQuery.");this._additionalCriteria.push(i),this.fields(["ObjectID","_ValidFrom","_ValidTo"])}return d(e,t),e}(i),o=function(t){function e(t,s,i){if(e.__super__.constructor.call(this,t,s),null==i)throw Error("Must provide a predicate when instantiating a TimeInStateAnalyticsQuery.");this._additionalCriteria.push(i),this._additionalCriteria.push({_ValidFrom:{$gte:s}}),this.fields(["ObjectID","_ValidFrom","_ValidTo"])}return d(e,t),e}(i),l.AnalyticsQuery=t,l.GuidedAnalyticsQuery=i,l.AtAnalyticsQuery=e,l.BetweenAnalyticsQuery=s,l.TimeInStateAnalyticsQuery=n,l.TransitionsAnalyticsQuery=o}).call(this);
</script>

        <!-- md5 -->
        
<script type="text/javascript">
(function(){function t(t,r,e){return t&r|~t&e}function r(t,r,e){return t&e|r&~e}function e(t,r,e){return t^r^e}function s(t,r,e){return r^(t|~e)}function i(t){return String.fromCharCode(255&t)+String.fromCharCode(255&t>>>8)+String.fromCharCode(255&t>>>16)+String.fromCharCode(255&t>>>24)}function a(t){for(;0>t;)t+=4294967296;for(;t>4294967295;)t-=4294967296;return t}function n(t,r,e,s,i){var n,o,l,u,p,y,c,d,f;n=s[0],o=s[1],l=s[2],u=s[3],p=i[0],y=i[1],c=i[2],f=e(r[o],r[l],r[u]),d=r[n]+f+t[p]+h[c],d=a(d),d=d<<y|d>>>32-y,d+=r[o],r[n]=a(d)}function o(t){var r,e,s,o,l,h,u,p,y,c,f,_,g;if(s=Array(1732584193,4023233417,2562383102,271733878),l=t.length,h=63&l,u=56>h?56-h:120-h,u>0)for(t+="Â€",c=0;u-1>c;c++)t+="\0";for(t+=i(8*l),t+=i(0),l+=u+8,r=Array(0,1,2,3),e=Array(16),o=Array(4),_=0;l>_;_+=64){for(c=0,f=_;16>c;c++,f+=4)e[c]=t.charCodeAt(f)|t.charCodeAt(f+1)<<8|t.charCodeAt(f+2)<<16|t.charCodeAt(f+3)<<24;for(c=0;4>c;c++)o[c]=s[c];for(c=0;4>c;c++)for(p=d[c][0],y=d[c][1],f=0;16>f;f++)n(e,o,p,r,y[f]),g=r[0],r[0]=r[3],r[3]=r[2],r[2]=r[1],r[1]=g;for(c=0;4>c;c++)s[c]+=o[c],s[c]=a(s[c])}return i(s[0])+i(s[1])+i(s[2])+i(s[3])}function l(t){var r,e,s,i;for(i=o(t),e="",r=0;16>r;r++)s=i.charCodeAt(r),e+="0123456789abcdef".charAt(15&s>>4),e+="0123456789abcdef".charAt(15&s);return e}var h=Array(0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745),u=Array(Array(0,7,1),Array(1,12,2),Array(2,17,3),Array(3,22,4),Array(4,7,5),Array(5,12,6),Array(6,17,7),Array(7,22,8),Array(8,7,9),Array(9,12,10),Array(10,17,11),Array(11,22,12),Array(12,7,13),Array(13,12,14),Array(14,17,15),Array(15,22,16)),p=Array(Array(1,5,17),Array(6,9,18),Array(11,14,19),Array(0,20,20),Array(5,5,21),Array(10,9,22),Array(15,14,23),Array(4,20,24),Array(9,5,25),Array(14,9,26),Array(3,14,27),Array(8,20,28),Array(13,5,29),Array(2,9,30),Array(7,14,31),Array(12,20,32)),y=Array(Array(5,4,33),Array(8,11,34),Array(11,16,35),Array(14,23,36),Array(1,4,37),Array(4,11,38),Array(7,16,39),Array(10,23,40),Array(13,4,41),Array(0,11,42),Array(3,16,43),Array(6,23,44),Array(9,4,45),Array(12,11,46),Array(15,16,47),Array(2,23,48)),c=Array(Array(0,6,49),Array(7,10,50),Array(14,15,51),Array(5,21,52),Array(12,6,53),Array(3,10,54),Array(10,15,55),Array(1,21,56),Array(8,6,57),Array(15,10,58),Array(6,15,59),Array(13,21,60),Array(4,6,61),Array(11,10,62),Array(2,15,63),Array(9,21,64)),d=Array(Array(t,u),Array(r,p),Array(e,y),Array(s,c));this.md5=l}).call(this);
</script>
        
        <!-- my visualizer for this chart (optional) -->
        <!-- <script type="text/javascript" src="../lib/localcache/LocalCache.js"></script> -->
        
<script type="text/javascript">
(function(){var t,e,i,r,s=function(t,e){return function(){return t.apply(e,arguments)}},n=[].slice;i="undefined"!=typeof exports&&null!==exports?require("../lib/Lumenize"):require("/lumenize"),r=i.utils,t=i.Time,e=function(){function e(t,e,i){this.visualizations=t,this.userConfig=e,this.createVisualizationCB=i,this.onSnapshotsReceieved=s(this.onSnapshotsReceieved,this),this.config=r.clone(this.userConfig),this.config.trace&&console.log("in VisualizerBase.constructor"),null==this.config.debug&&(this.config.debug=!1),this.getProjectAndWorkspaceScope()}return e.prototype.getProjectAndWorkspaceScope=function(){var t,e,i,r,s,n,o,a=this;return this.config.trace&&console.log("in VisualizerBase.getProjectAndWorkspaceScope"),top===self?(n=41529001,r=!1,i=!0,t=81147451,e=[t]):(n=__WORKSPACE_OID__,r=__PROJECT_SCOPING_UP__,i=__PROJECT_SCOPING_DOWN__,t=__PROJECT_OID__,e=[__PROJECT_OIDS_IN_SCOPE__]),s={workspaceOID:n,projectScopingUp:r,projectScopingDown:i,projectOID:t,projectOIDsInScope:e},o=function(t){return a.projectAndWorkspaceScope=t,a.getWorkspaceConfiguration()},o(s)},e.prototype.getWorkspaceConfiguration=function(){var t,e,i=this;return this.config.trace&&console.log("in VisualizerBase.getWorkspaceConfiguration"),t={DateFormat:"MM/dd/yyyy",DateTimeFormat:"MM/dd/yyyy hh:mm:ss a",IterationEstimateUnitName:"Points",ReleaseEstimateUnitName:"Points",TaskUnitName:"Hours",TimeTrackerEnabled:!0,TimeZone:"America/Denver",WorkDays:"Monday,Tuesday,Wednesday,Thursday,Friday"},e=function(t){return i.workspaceConfiguration=t,i.initialize(),i.onConfigOrScopeUpdated()},e(t)},e.prototype.onConfigOrScopeUpdated=function(){var t;return this.config.trace&&console.log("in VisualizerBase.onConfigOrScopeUpdated"),t=void 0,null!=t?(this.config.debug&&(console.log("Found a saved state in cache. Restoring from savedState. Size:",JSON.stringify(t).length),console.log(t)),this.lumenizeCalculator=this.LumenizeCalculatorClass.newFromSavedState(t),this.upToDateISOString=this.lumenizeCalculator.upToDateISOString):(this.config.debug&&console.log("Did not find a saved state in cache. Calculating from scratch."),this.lumenizeCalculator=new this.LumenizeCalculatorClass(this.config.lumenizeCalculatorConfig),this.upToDateISOString=null),this.fetchPending=!0,this.createVisualization(),this.dirty=!1,this.onNewDataAvailable()},e.prototype.getCurrentState=function(){var t,e,i,r,s,n=this;return this.config.trace&&console.log("in VisualizerBase.getCurrentState"),r=function(t){var e;return console.log(t),n.currentState=t.allResults,n.currentObjectIDs=function(){var t,i,r,s;for(r=this.currentState,s=[],t=0,i=r.length;i>t;t++)e=r[t],s.push(e.ObjectID);return s}.call(n),n.onNewDataAvailable()},e={"X-RallyIntegrationName":"Burn Chart (prototype)","X-RallyIntegrationVendor":"Rally Red Pill","X-RallyIntegrationVersion":"0.2.0",workspaceOID:this.projectAndWorkspaceScope.workspaceOID},this.analyticsQuery=new GuidedAnalyticsQuery(e),"scope"===this.config.scopeValue?this.projectAndWorkspaceScope.projectScopingUp?(this.config.debug&&console.log("Project scoping up. OIDs in scope: ",this.projectAndWorkspaceScope.projectOIDsInScope),this.analyticsQuery.scope("Project",this.projectAndWorkspaceScope.projectOIDsInScope)):this.projectAndWorkspaceScope.projectScopingDown?(this.config.debug&&console.log("Project scoping down. Setting _ProjectHierarchy to: ",this.projectAndWorkspaceScope.projectOID),this.analyticsQuery.scope("_ProjectHierarchy",this.projectAndWorkspaceScope.projectOID)):(this.config.debug&&console.log("Project with no up or down scoping. Setting Project to: ",this.projectAndWorkspaceScope.projectOID),this.analyticsQuery.scope("Project",this.projectAndWorkspaceScope.projectOID)):null!=(null!=(s=this.config.scopeData)?s.ObjectID:void 0)?(i=this.config.scopeData.ObjectID,this.analyticsQuery.scope(this.config.scopeField,i)):(i=this.config.scopeValue,this.analyticsQuery.scope(this.config.scopeField,i)),t=["ObjectID"],this.analyticsQuery.fields(t),this.config.leafOnly&&this.analyticsQuery.leafOnly(),null!=this.config.type&&this.analyticsQuery.type(this.config.type),this.analyticsQuery.additionalCriteria(this.config.currentStatePredicate),this.analyticsQuery.additionalCriteria({__At:"current"}),this.config.debug&&(this.analyticsQuery.debug(),console.log("Requesting current state data ...")),this.analyticsQuery.getAll(r)},e.prototype.getAsOfISOString=function(){return this.asOfISOString=null!=this.config.asOf?new t(this.config.asOf,"millisecond").getISOStringInTZ(this.config.lumenizeCalculatorConfig.tz):t.getISOStringFromJSDate()},e.prototype.onSnapshotsReceieved=function(e,i,r,s){var n;return null==s&&(s=null),this.config.trace&&console.log("in VisualizerBase.onSnapshotsReceieved"),this.dirty=e.length>0&&new t(r,t.MILLISECOND,this.config.tz).getJSDate("GMT").getTime()-new t(i,t.MILLISECOND,this.config.tz).getJSDate("GMT").getTime()>3e5?!0:!1,this.upToDateISOString=r,this.deriveFieldsOnSnapshots(e),n=this.getAsOfISOString(),r>n&&(r=n),this.updateCalculator(e,i,r),this.fetchPending=null!=this.config.asOf&&this.upToDateISOString<this.config.asOf?!1:this.analyticsQuery.hasMorePages()?!0:!1,this.updateVisualization(),null!=this.config.asOf&&this.upToDateISOString<this.config.asOf?void 0:this.analyticsQuery.hasMorePages()?this.onNewDataAvailable():this.newDataExpected(void 0,this.config.refreshIntervalMilliseconds)},e.prototype.newDataExpected=function(t,e){var i;return null==t&&(t=3e4),null==e&&(e=18e5),this.config.trace&&console.log("in VisualizerBase.newDataExpected"),i=e+t,null!=this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(this.onConfigOrScopeUpdated,i)},e.prototype.removeFromCacheAndRecalculate=function(){return this.config.trace&&console.log("in VisualizerBase.removeFromCacheAndRecalculate"),this.upToDateISOString=null,this.cache.removeItem(this.getHashForCache()),this.onConfigOrScopeUpdated()},e.prototype.updateCalculator=function(){var t,e,i,r,s,o;return r=arguments[0],s=arguments[1],t=arguments[2],e=arguments.length>=4?n.call(arguments,3):[],this.config.trace&&console.log("in VisualizerBase.updateCalculator"),(o=this.lumenizeCalculator).addSnapshots.apply(o,[r,s,t].concat(n.call(e))),i=this.lumenizeCalculator.getStateForSaving()},e.prototype.initialize=function(){return this.dirty=!0,this.virgin=!0,this.config.trace&&console.log("in VisualizerBase.initialize"),null==this.config.lumenizeCalculatorConfig&&(this.config.lumenizeCalculatorConfig={}),this.config.lumenizeCalculatorConfig.workDays=this.workspaceConfiguration.WorkDays,null!=this.userConfig.tz?this.config.lumenizeCalculatorConfig.tz=this.userConfig.tz:(this.config.tz=this.workspaceConfiguration.TimeZone,this.config.lumenizeCalculatorConfig.tz=this.workspaceConfiguration.TimeZone)},e.prototype.deriveFieldsOnSnapshots=function(t){return this.config.trace&&console.log("in VisualizerBase.deriveFieldsOnSnapshots"),null!=this.config.deriveFieldsOnSnapshotsConfig?Lumenize.deriveFields(t,this.config.deriveFieldsOnSnapshotsConfig):void 0},e.prototype.createVisualization=function(){return this.config.trace&&console.log("in VisualizerBase.createVisualization. @dirty: ",this.dirty),this.updateVisualizationData(),this.createVisualizationCB(this.visualizationData)},e.prototype.updateVisualization=function(){return this.config.trace&&console.log("in VisualizerBase.updateVisualization. @dirty: ",this.dirty),this.updateVisualizationData(),this.dirty||this.virgin?(this.dirty=!1,this.virgin=!1,this.createVisualizationCB(this.visualizationData)):void 0},e.prototype.onNewDataAvailable=function(){return this.config.trace&&console.log("in VisualizerBase.onNewDataAvailable"),this.fetchPending=!0,this.analyticsQuery.getPage(this.onSnapshotsReceieved)},e.prototype.updateVisualizationData=function(){return this.config.trace?console.log("in VisualizerBase.updateVisualizationData"):void 0},e.prototype.getHashForCache=function(){return this.config.trace?console.log("in VisualizerBase.getHashForCache"):void 0},e}(),this.VisualizerBase=e}).call(this);
</script> 
        
<script type="text/javascript">
(function(){var t,e,i,r,s=function(t,e){return function(){return t.apply(e,arguments)}},o={}.hasOwnProperty,n=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};e="undefined"!=typeof exports&&null!==exports?require("../lib/lumenize"):require("/lumenize"),i=e.utils,t=function(t){function o(){return this.onNewDataAvailable=s(this.onNewDataAvailable,this),r=o.__super__.constructor.apply(this,arguments)}return n(o,t),o.prototype.initialize=function(){var t,r,s,n,l,c,h;for(this.config.trace&&console.log("in TIPVisualizer.initialize"),o.__super__.initialize.call(this),this.config.toolTipFieldNames=[],c=this.config.showTheseFieldsInToolTip,n=0,l=c.length;l>n;n++)r=c[n],t="string"===i.type(r)?r:r.field,this.config.toolTipFieldNames.push(t);return s=["_ValidTo"].concat(this.config.toolTipFieldNames),h=this.config.radiusField.field,0>a.call(s,h)&&s.push(this.config.radiusField.field),this.config.lumenizeCalculatorConfig.trackLastValueForTheseFields=s,this.config.lumenizeCalculatorConfig.granularity="hour",this.config.lumenizeCalculatorConfig.workDayStartOn=this.config.workDayStartOn,this.config.lumenizeCalculatorConfig.workDayEndBefore=this.config.workDayEndBefore,this.config.lumenizeCalculatorConfig.holidays=this.config.holidays,this.config.lumenizeCalculatorConfig.workDays=this.config.workDays,this.LumenizeCalculatorClass=e.TimeInStateCalculator},o.prototype.onNewDataAvailable=function(){var t;return this.config.trace&&console.log("in TIPVisualizer.onNewDataAvailable"),t={"X-RallyIntegrationName":"TIP Chart (prototype)","X-RallyIntegrationVendor":"Rally Red Pill","X-RallyIntegrationVersion":"0.2.0",workspaceOID:this.projectAndWorkspaceScope.workspaceOID},null==this.upToDateISOString&&(this.upToDateISOString="2011-12-01T00:00:00.000Z"),this.analyticsQuery=new TimeInStateAnalyticsQuery(t,this.upToDateISOString,this.config.statePredicate),this.projectAndWorkspaceScope.projectScopingUp?(this.config.debug&&console.log("Project scoping up. OIDs in scope: ",this.projectAndWorkspaceScope.projectOIDsInScope),this.analyticsQuery.scope("Project",this.projectAndWorkspaceScope.projectOIDsInScope)):this.projectAndWorkspaceScope.projectScopingDown?(this.config.debug&&console.log("Project scoping down. Setting _ProjectHierarchy to: ",this.projectAndWorkspaceScope.projectOID),this.analyticsQuery.scope("_ProjectHierarchy",this.projectAndWorkspaceScope.projectOID)):(this.config.debug&&console.log("Project with no up or down scoping. Setting Project to: ",this.projectAndWorkspaceScope.projectOID),this.analyticsQuery.scope("Project",this.projectAndWorkspaceScope.projectOID)),this.analyticsQuery.type(this.config.type).fields(this.config.toolTipFieldNames),this.config.leafOnly&&this.analyticsQuery.leafOnly(),null!=this.config.asOf&&this.analyticsQuery.additionalCriteria({_ValidFrom:{$lt:this.getAsOfISOString()}}),this.config.debug&&(this.analyticsQuery.debug(),console.log("Requesting data...")),this.fetchPending=!0,this.analyticsQuery.getPage(this.onSnapshotsReceieved)},o.prototype.getHashForCache=function(){var t,e,r,s,o;return this.config.trace&&console.log("in TIPVisualizer.getHashForCache"),t={},o=i.clone(this.userConfig),delete o.debug,delete o.trace,delete o.daysToShow,delete o.showStillInProgress,t.userConfig=o,t.projectAndWorkspaceScope=this.projectAndWorkspaceScope,t.workspaceConfiguration=this.workspaceConfiguration,s="TIP v0.2.95",e=JSON.stringify(t),r=md5(e+s)},o.prototype.updateVisualizationData=function(){var t,i,r,s,o,n,a,l,c,h,u,p,g,f,d,y,_,S,A,m,C,v,D,O,w,R,z,I,T,P,j,b,k,V,E,F;if(this.config.trace&&console.log("in TIPVisualizer.updateVisualizationData"),o=this.lumenizeCalculator.getResults(),0===o.length){if(this.config.debug&&console.log("No calculatorResults."),this.fetchPending)return this.config.debug&&console.log("fetchPending is true so returning with visualizationData = null."),this.visualizationData=null,void 0;_=[],this.config.debug&&console.log("fetchPending is false so filling in with blanks")}else{for(this.virgin=!1,p=[],d=[],t=null!=this.config.asOf?new e.Time(this.config.asOf,"millisecond",this.config.lumenizeCalculatorConfig.tz).getJSDate(this.config.lumenizeCalculatorConfig.tz).getTime():(new Date).getTime(),f=24*60*60*1e3*this.userConfig.daysToShow,S=t-f,D=0,z=o.length;z>D;D++)y=o[D],g=new e.Time(y._ValidTo_lastValue,"millisecond",this.config.lumenizeCalculatorConfig.tz).getJSDate(this.config.lumenizeCalculatorConfig.tz).getTime(),y.x=g>t?t:g,y.x-=24*60*60*1e3*Math.random(),null!=this.config.radiusField&&(y.marker={radius:this.config.radiusField.f(y[this.config.radiusField.field+"_lastValue"])}),g>S&&(t>g?d.push(y):p.push(y));for(A=60*this.config.workDayStartOn.hour,(null!=(E=this.config.workDayStartOn)?E.minute:void 0)&&(A+=this.config.workDayStartOn.minute),l=60*this.config.workDayEndBefore.hour,(null!=(F=this.config.workDayEndBefore)?F.minute:void 0)&&(l+=this.config.workDayEndBefore.minute),l>A?v=l-A:(v=1440-A,v+=l),C=v/60,O=0,I=p.length;I>O;O++)y=p[O],y.days=y.ticks/C;for(w=0,T=d.length;T>w;w++)y=d[w],y.days=y.ticks/C}if(u=e.histogram(d,"days"),null==u)return this.config.debug&&console.log("No histogramResults. Returning."),void 0;for(s=u.buckets,n=u.chartMax,m=u.valueMax,r=u.bucketSize,a=u.clipped,R=0,P=d.length;P>R;R++)y=d[R],y.y=y.clippedChartValue;for(k=0,j=p.length;j>k;k++)y=p[k],y.y=y.days>n?n:y.days;for(c=[],h=[],V=0,b=s.length;b>V;V++)i=s[V],c.push(i.label),h.push(i.count);return _=[{name:"Not in Process",data:d},{name:"In Process",data:p},{name:"Percentile",data:[],yAxis:1,showInLegend:!1}],this.visualizationData={series:_,histogramResults:u,histogramCategories:c,histogramData:h,startMilliseconds:S,asOfMilliseconds:t}},o}(VisualizerBase),this.TIPVisualizer=t}).call(this);
</script>
        
        <script type="text/javascript">
            (function() {

                var charts = {};
                var visualizer;
                
                createVisualization = function(visualizationData) {
                
                  if (typeof visualizationData !== "undefined" && visualizationData !== null) {
                    
                    var series = visualizationData.series;
                    var histogramResults = visualizationData.histogramResults;
                    var startMilliseconds = visualizationData.startMilliseconds
                    var asOfMilliseconds = visualizationData.asOfMilliseconds

                    var histogramCategories = visualizationData.histogramCategories;
                    var histogramData = visualizationData.histogramData;
                    
                    var bucketSize = histogramResults.bucketSize;
                    var chartMax = histogramResults.chartMax;
                    var buckets = histogramResults.buckets;
                    var clipped = histogramResults.clipped;
                    var valueMax = histogramResults.valueMax;
                
                    charts.scatterChart = new Highcharts.Chart({
                      chart: {
                         renderTo: 'scatter-container',
                         defaultSeriesType: 'scatter',
                         zoomType: 'x',
                         marginTop: 80
                      },
                      legend: {
                         enabled: true,
                         floating: true,
                         align: 'center',
                         verticalAlign: 'top',
                         y: 37
                      },
                      credits: {
                         enabled: false
                      },
                      title: {
                         text: 'Time In Process'
                      },
                      subtitle: {
                         text: userConfig.subTitle
                      },
                      xAxis: {
                         startOnTick: false,
                         tickmarkPlacement: 'on',
                         title: {
                             enabled: false
                         },
                         type: 'datetime',
                         min: startMilliseconds,
                         max: asOfMilliseconds
                      },
                      yAxis: [
                         {
                             title: {
                                 text: 'Time In Process (Work Days)'
                             },
                             opposite: false,
                             endOnTick: false,
                             tickInterval: bucketSize,
                             labels: {
                               formatter: function() {
                                   if (this.value !== 0) {
                                     if (this.value == chartMax) {
                                       if (clipped) {
                                         return '' + valueMax + '*';
                                       } else {
                                         return chartMax;
                                       }
                                     } else {
                                       return this.value;
                                     }
                                   }
                                 }
                               
                             },
                             min: 0,
                             max: chartMax
                         },
                         {
                             title: {
                                 text: null
                             },
                             opposite: true,
                             // endOnTick: true,
                             tickInterval: 1,
                             labels: {
                                 formatter: function() {
                                    if (this.value !== 0) {
                                      return Highcharts.numberFormat(buckets[this.value - 1].percentile * 100, 1) + "%";
                                    } else {
                                      return "0.0%";
                                    }
                                  }
                             },
                             min: 0,
                             max: buckets.length                        
                         }
                      
                      ],                      
                      tooltip: {
                         formatter: function() {
                             var point = this.point;
                             tooltip = 'ObjectID: ' + point.ObjectID + '<br />';  // !TODO: Upgrade to link to revisions page in Rally
                             tooltip += this.series.name + ': <b>' + Highcharts.numberFormat(point.days, 1) + '</b> work days';
                             var t, _i, _len, _ref, f, field, as;
                             _ref = userConfig.showTheseFieldsInToolTip;
                             for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                                t = _ref[_i];
                                if (typeof t === 'string') {
                                  field = t;
                                  f = function(value) {
                                    return value;
                                  };
                                  as = t;
                                } else {
                                  field = t.field;
                                  if (t.f != null) {
                                    f = t.f;
                                  } else {
                                    f = function(value) {
                                      return value;
                                    };
                                  }
                                  if (t.as != null) {
                                    as = t.as;
                                  } else {
                                    as = t.field;
                                  }
                                }
                                tooltip += '<br />' + as + ': ' + f(point[field + "_lastValue"]);
                             }
                             return tooltip;
                         }
                      },
                      plotOptions: {
                          scatter: {
                             marker: {
                                states: {
                                   hover: {
                                      enabled: false
                                   }
                                }
                             }
                          },
                          series: {
                              events: {
                                  legendItemClick: function(event) {
                                      if (this.index == 0) {
                                          if (!this.visible) {
                                             this.chart.xAxis[0].setExtremes(startMilliseconds, asOfMilliseconds, false);
                                          } else {
                                             this.chart.xAxis[0].setExtremes(asOfMilliseconds - 24 * 60 * 60 * 1000, asOfMilliseconds, false);
                                          };
                                          this.chart.redraw();
                                      };
                                      return true;
                                  }
                              }                          
                          }
                      },
                      series: series
                    }, function(chart) {
                        if (clipped) {
                          chart.renderer.text('* non-linear', 57, 55).add();
                        };
                        if (series[0].data.length == 0) {
                          chart.renderer.text('No matching data for this project and scope.', chart.chartWidth / 2 - 127, chart.chartHeight / 2 - 100).add();
                        }
                    });  // end of scatterChart
              
                    charts.histogramChart = new Highcharts.Chart({
                   		chart: {
                   			renderTo: 'histogram-container',
                   			type: 'bar',
                   			marginTop: 80
                   		},
                       legend: {
                         enabled: false
                       },
                       credits: {
                           enabled: false
                       },
                   		title: {
                   			text: 'Histogram'
                   		},
                   		subtitle: {
                   			text: 'for Not In Process'
                   		},
                   		xAxis: [{ // mirror axis on right side
                   			opposite: false,
                   			reversed: false,
                   			categories: histogramCategories,
                   		}],
                   		yAxis: {
                   			title: {
                   				text: null
                   			},
                         labels: {
                   				formatter: function(){
                   					return Math.abs(this.value);
                   				}
                   			},
                   			min: 0
                   		},
                   		plotOptions: {
                   			series: {
                   				stacking: 'normal'
                   			}
                   		},
                   		tooltip: {
                   			formatter: function(){
                   				return '' + this.point.category +' work days: <b>' + Highcharts.numberFormat(Math.abs(this.point.y), 0) + '</b>';
                   			}
                   		},
                   		series: [{
                   			name: 'Time in process',
                   			data: histogramData
                   		}]
                   	}, function(chart) {
                   	     if (false) {
                            chart.renderer.text('* non-linear', 200, 65).add();
                          };
                    });  // end of histogramChart
                    
                  } else {
                    // Put a spinner in the chart containers until first fetch returns
                    $('#scatter-container')
                      .html('<img height="20px" src="https://rally1.rallydev.com/slm/js-lib/ext/2.2/resources/images/default/grid/loading.gif"></img>')
                      .attr("style", "text-align:center");
                    $('#histogram-container')
                      .html('<img height="20px" src="https://rally1.rallydev.com/slm/js-lib/ext/2.2/resources/images/default/grid/loading.gif"></img>')
                      .attr("style", "text-align:center");
                  };  // end of if visualizationData?
                
                };  // end of createVisualization  
                  
    
                $(document).ready(function() {
                  visualizer = new TIPVisualizer(charts, userConfig, createVisualization);
                });
            
            })();
            
                
        </script>

        
    </head>
    <body>
        
        <!-- 3. Add the containers -->
        <table cellpading="0px" cellspacing="0px" width="98%" height="98%">
          <tr>
            <td width="65%"><div id="scatter-container" style="width: 100%; height: 100%; margin: 0 auto"></div></td>
            <td width="35%"><div id="histogram-container" style="width: 100%; height: 100%; margin: 0 auto"></div></td>
          </tr>
        </table>
                
    </body>
</html>


